<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configurar  y gestionar sitios en Nginx II - Jonathan Álvarez González
    </title>
    <meta name="description" content="Frontend developer but also worken with backend technologies everyday. I also like designing. Here you will find some links and articles I'd write">
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="Jonathan Álvarez González is a frontend developer from Colombia. In this site you will find articles and toughts about web development">
    <link href="/favicon.ico" rel="shortcut icon">
    <link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  </head>
  <body class="article">
    <div class="wrap">
      <article class="content">
        <header style="background-image: url('nginx_featured_image_emerald_bg.jpg');" class="article-header grid grid--vertical-align grid--horizontal-align">
          <div class="article-inner text-center">
            <div class="article-meta"></div>
            <h1 class="article-title default-wrap">Configurar  y gestionar sitios en Nginx II</h1>
            <div class="article-meta"><span>January 24th 2014</span></div>
          </div>
        </header>
        <section class="article-content default-wrap"><p>Continuando, y ahora que tenemos nuestra <a href="http://blog.jonalvarezz.com/configurar-y-gestionar-sitios-en-nginx/">configuración global para Nginx</a>, veremos cómo administrar nuestros&nbsp;sitios.</p>
<p>Primero creamos dos carpetas sobre el directorio de configuración de&nbsp;Nginx</p>
<pre><code>cd /etc/nginx/
mkdir -p sites-available
mkdir -p sites-enabled
</code></pre><p>Los nombres de las carpetas describen su funcionalidad. <strong>Esto es importante:</strong> Crearemos un archivo <code>misitio.conf</code> en <code>sites-available</code> por cada sitio que queramos en nuestro&nbsp;servidor.</p>
<blockquote>
<p>En algunas distribuciones, como Ubuntu, viene un archivo predefinido llamado default. Recomiendo borrarlo y utilizar <code>misitio.conf</code></p>
</blockquote>
<p>De este modo, cada archivo <code>.conf</code> describirá configuraciones específicas para cada sitio, por ejemplo incluir o no <code>php</code> o servir como un frontend proxy para usar <code>node</code>, <code>django</code> ó demás. Nginx es supremamente&nbsp;flexible.</p>
<p>Así, un sitio típico con php para Nginx sería: <code>/etc/nginx/sites-available/misitio.conf</code></p>
<pre><code>server {
        listen 80;

    server_name misitio.com;

    root /srv/http/misitio;
    index index.php index.html index.htm;

    # limit_conn limit_per_ip 16; ssi on;
                #location / {
        #  Enables directory listings when index file not found
    # autoindex on; Shows file listing times as local time autoindex_localtime on; Enable for vBulletin usage WITHOUT 
    # vbSEO installed try_files $uri $uri/ /index.php; root /usr/share/nginx/html; index index.html index.htm;
                #}

    location / {
            root /srv/http/misitio;
        try_files $uri $uri/ /index.php?$args;
                }
    include /etc/nginx/global/php.conf;
    include /etc/nginx/global/drop.conf;
}
</code></pre><p>Aclaremos unas&nbsp;cosas:</p>
<ul>
<li><code>server_name</code> Lleva el dominio, en caso de no tener uno aún, usen la <span class="caps">IP</span> del&nbsp;servidor.</li>
<li><code>root</code> Especifica la ruta del servidor donde se encuentran los archivos del sitio. Es decir que en <code>/srv/http/</code> existe una carpeta de nombre <code>misitio</code> que contiene mis archivos de <code>html</code>, <code>php</code>, <code>css</code> y demás. <strong>Usen siempre carpeta por sitio, así solo sea&nbsp;uno.</strong></li>
<li><code>include</code> Incluye archivos/ módulos adicionales para ese sitio que Nginx deberá tener en cuenta. Para este caso agregamos el módulo para ejecutar <code>php</code> y algunas excepciones para el servidor en <code>drop.conf</code> que <a href="http://blog.jonalvarezz.com/configurar-y-gestionar-sitios-en-nginx/">antes habíamos definido</a>.</li>
</ul>
<p>El sitio está añadido, habilitémoslo&nbsp;entonces:</p>
<pre><code>cd /etc/nginx/sites-enabled/
ln -s ../sites-available/misitio.conf misitio.conf
</code></pre><p>Si, sólo creamos un enlace simbólico a la configuración del sitio que queremos habilitar. Así no perdemos archivos de configuración cuando queramos dar sitios de&nbsp;baja.</p>
<p>Y sólo por confirmar, definamos permisos sobre la carpeta de nuestro&nbsp;sitio</p>
<pre><code># chown -hR http:http /srv/http/
</code></pre><p>Recuerden cambiar el usuario <code>http</code> por el usuario correcto, por ejemplo en ubuntu debería ser <code>www-data</code>; Así mismo la ruta de archivos públicos, que en Ubuntu sería <code>/home/www/public/misitio/</code></p>
<p>Nuestra configuración esta lista. Verificamos que todo este bien ejecutando <code>nginx -t</code> y reiniciamos el servicio de Nginx con <code>sudo systemctl nginx restart</code>. No debería aparecer algún error, y nuestro sitio debería ser visible desde el dominio especificado en <code>server_name</code>.</p>
</section>
        <aside class="article-share text-center default-wrap">
          <hr><a href="https://twitter.com/share?text=Configurar%20%20y%20gestionar%20sitios%20en%20Nginx%20II by @jonalvarezz&amp;url=" title="Share on Twitter" onclick="this.href+=window.location.href; window.open(this.href, 'twitter-share', 'width=550,height=330');return false;"><i class="fa fa-twitter"></i></a><a href="https://www.facebook.com/sharer/sharer.php?u=" title="Share on Facebook" onclick="this.href+=window.location.href; window.open(this.href, 'facebook-share', 'width=580,height=330');return false;"><i class="fa fa-facebook"></i></a>
        </aside>
        <footer class="footer-article">
          <div class="default-wrap">
            <nav class="article-pagination grid grid--vertical-align">
              <div class="prev grid-item grid-item--half text-left">
                <div><small>PREV</small></div><a href="/articles/optimizar-el-rendimiento-y-tiempo-de-carga-de-wordpress-en-5-simples-pasos/">Optimizar el Rendimiento y Tiempo de Carga de Wordpress en 7 pasos</a>
              </div>
              <div class="next grid-item grid-item--half text-right">
                <div><small>NEXT</small></div><a href="/articles/configurar-y-gestionar-sitios-en-nginx/">Configurar y gestionar sitios en Nginx I</a>
              </div>
            </nav>
            <div class="footer-colophon text-center"><small><a href="/" title="Go home">JONATHAN ÁLVAREZ G ©</a></small></div>
          </div>
        </footer>
      </article>
    </div>
    <script>
      WebFontConfig = {
        google: { families: [ 'Source+Sans+Pro:700,400:latin', 'Source+Serif+Pro:400,700:latin' ] }
      };
      (function() {
        var wf = document.createElement('script');
        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
        wf.type = 'text/javascript';
        wf.async = 'true';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wf, s);
      })()
    </script>
  </body>
</html>